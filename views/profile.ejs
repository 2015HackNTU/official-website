<!doctype html>
<html>
<head>
	<title>Node Authentication</title>
	<link rel="stylesheet" href="/stylesheets/bootstrap.css">
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
	<link rel="stylesheet" href="/stylesheets/semantic.css">
	<link rel="text/javascript" href="/javascripts/semantic.js">
	<script src="/javascripts/jquery.min.js"></script>
	<style>
		body 		{ padding-top:10px; word-wrap:break-word; }
	</style>
</head>
<body>
<div class="container">

	<div class="page-header text-center">
		<h1><span class="fa fa-anchor"></span> Profile Page</h1>
			<h3><span class="fa fa-star"></span> Hello, <%= user.local.name %> Welcome back!</h3>

		<a href="/logout" class="btn btn-default btn-sm">Logout</a>
	</div>
			<div class="modal">
				<form action="/user/edit/<%=user._id%>" method="post">
					<input type="text" name="name" autofocus="autofocus" placeholder="Name" length="5px"/>
                    <input type="text" name="department" autofocus="autofocus" placeholder="Department"/><br><br>
                    <input type="text" name="username" id="username" autofocus="autofocus" placeholder="Username">
                    <input type="password" name="password" autofocus="autofocus" placeholder="password"/>
					<input type="hidden" name="id" value="<%=user._id%>">
                    <br><br>
	                <input type="submit" class="btn btn-deafult" name="todo-submit" value="Update"/>	
				</form>
			</div>
	<div class="row">

		<!-- LOCAL INFORMATION -->
		<div class="col-sm-3">
			<div class="ui card">
				<div class="image">
					<img src="http://graph.facebook.com/<%= user.facebook.id %>/picture?type=large" >
				</div>
			    <div class="content">
    				<a class="header"><%= user.local.name %></a>
    				<div class="description">
    					<span calss="description"> Member of <%= user.local.department%></span>
    				</div>
    				<div class="meta">
	      				<span class="date"></span><br>
    				</div>
			    </div>
				<div class="extra content" >
					<a class="btn btn-primary" id="edit" href="/user/edit/<%= user._id %>"><p style="color:white">Edit Info</p></a>
				</div>

			</div>
		</div>

		<!-- FACEBOOK INFORMATION -->
		<div class="col-sm-9">
			<div class="well" style="padding-top:0px">
			<% if (!user.facebook.token) { %>
				<h1>Hurry up! Connect your facebook account!</h1>
			<% } %>
				<!-- check if the user has this token (is the user authenticated with this social account) -->
				<% if (user.facebook.token) { %>
					<h3 class="text-primary">
						<span class="fa fa-facebook fa-lg"></span>&nbsp;&nbsp;
						Facebook
					</h3>
					<p>
						<strong>id</strong>: <%= user.facebook.id %><br>
						<strong>token</strong>: <%= user.facebook.token %><br>
						<strong>email</strong>: <%= user.facebook.email %><br>
						<strong>name</strong>: <%= user.facebook.name %><br>
					</p>

					<a href="/unlink/facebook" class="btn btn-primary">Unlink</a>
				<% } else { %>
					<a href="/connect/facebook" class="btn btn-primary">Connect Facebook</a>
				<% } %>

			</div>

			<div class="well" style="padding-top:0px">
				<h3>
					<span class="fa fa-pencil fa-lg"></span>&nbsp;&nbsp;Blog Posts
					<div style="text-align:right">
						<a href="/posts/new"><span class="fa fa-pencil-square-o"></span>Newposts</a>
					</div>
				</h3>
					<% if(posts) {%>
						<table class="ui table">
							<thead>
							    <tr>
									<th>Title</th>
									<th>Content</th>
									<!-- <th>Tags</th> -->
									<th>Create Date</th>
									<th>Edit</th>
									<th>Delete</th>
							    </tr>
						  	</thead>
		  					<% posts.forEach(function(posts){ %>
								<% if(posts.user_id === user.id) {%>
								  	<tbody>
									    <tr>
									      <td><%= posts.title %></td>
									      <td><%= posts.content %></td>
									      <!-- <td><%= posts.tag %></td> -->
									      <td><span class="posts_date<%= posts._id %>"></span></td>
									      <td><a href="/posts/edit/<%= posts._id %>">Edit</a></td>
									      <td><a href="/posts/delete/<%= posts._id %>">Delete</a></td>
									    </tr>
								  	</tbody>

									<script>
										var monthNames = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ];
										$('.posts_date<%=posts._id%>').append(monthNames[<%= posts.create_at.getMonth() %>] + " " + <%= posts.create_at.getDate() %> + ", " + <%= posts.create_at.getYear()+1900 %> + " | "+ <%= (posts.create_at.getHours()%12) %> + ":" + <%= posts.create_at.getMinutes()%> )
									</script>
								<% } %>
							<% }) %>
						</table>	
				<% }%>
			</div>

			<div class="well" style="padding-top:0px">
				<h3><span class="fa fa-star-o fa-lg"></span>&nbsp;&nbsp;Breaking News</h3>
				
			</div>
		</div>
	</div>


	
	<div class="row">
		<div class="text-center" style="padding:40px">
			<p>- Hack NTU 2015 -</p>
		</div>
	</div>
</div>
</body>
<script>

// show Join time
var monthNames = [ "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December" ];
$('.date').append("Joined in " + monthNames[<%= user.local.create_at.getMonth() %>] + " " + <%= user.local.create_at.getDate() %> + ", " + <%= user.local.create_at.getYear()+1900 %>)

// show Join time



$('.modal')
	.modal('attach events', 'test', 'show')
;
$('#edit').click(function(){
	$('.text-center').append("poka")
	$('.modal').modal('show')
})
</script>
</html>